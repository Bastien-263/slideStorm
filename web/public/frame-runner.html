<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frame Runner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.12.7/dist/Recharts.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    #root {
      /* Force strict 16:9 aspect ratio */
      aspect-ratio: 16 / 9;
      width: 100%;
      max-width: 100vw;
      max-height: 100vh;
      overflow: hidden;
      background: white;
      position: relative;
    }
    /* Ensure content fits within 16:9 */
    #root > * {
      width: 100%;
      height: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    const { useState, useEffect, useMemo, useCallback } = React;

    // Simple Button component
    const Button = ({ children, variant, size, disabled, className = '', onClick, ...props }) => {
      const baseClasses = 'inline-flex items-center justify-center transition-all';
      const variantClasses = variant === 'outline' ? 'border border-current' : '';
      const sizeClasses = size === 'icon' ? 'p-2' : size === 'lg' ? 'px-6 py-3' : 'px-4 py-2';
      const disabledClasses = disabled ? 'opacity-30 cursor-not-allowed' : 'cursor-pointer';

      const handleClick = (e) => {
        if (!disabled && onClick) {
          onClick(e);
        }
      };

      return (
        <button
          onClick={handleClick}
          disabled={disabled}
          className={`${baseClasses} ${variantClasses} ${sizeClasses} ${disabledClasses} ${className}`}
          {...props}
        >
          {children}
        </button>
      );
    };

    // Lucide icons (common implementations)
    const ChevronLeft = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const ChevronRight = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );

    const ArrowLeft = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
    );

    const ArrowRight = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12 5 19 12 12 19"></polyline>
      </svg>
    );

    const CheckCircle = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    );

    const XCircle = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
    );

    const TrendingUp = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const TrendingDown = ({ className, ...props }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
        <polyline points="17 18 23 18 23 12"></polyline>
      </svg>
    );

    // Listen for code from parent
    window.addEventListener('message', async (event) => {
      if (event.data.type === 'EXECUTE_CODE') {
        const code = event.data.code;

        try {
          // Transform the code
          let transformedCode = code;

          // Remove imports
          transformedCode = transformedCode.replace(/^import\s+.*?from\s+["'].*?["'];?\s*$/gm, '');

          // Remove exports
          transformedCode = transformedCode
            .replace(/^export\s+default\s+/gm, '')
            .replace(/^export\s+(const|function|class)\s+/gm, '$1 ');

          // Use Babel to transform JSX to JavaScript
          const babelTransformed = Babel.transform(transformedCode, {
            presets: ['react'],
            filename: 'component.tsx'
          }).code;

          // Find component name
          const componentMatch = transformedCode.match(/(?:const|function)\s+(\w+)\s*=?\s*(?:\(\)|=>|\()/);
          const componentName = componentMatch ? componentMatch[1] : null;

          if (componentName) {
            // Wrap in function that returns the component
            const wrappedCode = `
              ${babelTransformed}

              return ${componentName};
            `;

            // Execute the code to get the component
            // Provide all available components and icons
            const componentFactory = new Function(
              'React', 'useState', 'useEffect', 'useMemo', 'useCallback',
              'Button', 'ChevronLeft', 'ChevronRight', 'ArrowLeft', 'ArrowRight',
              'CheckCircle', 'XCircle', 'TrendingUp', 'TrendingDown',
              'Recharts',
              wrappedCode
            );

            const Component = componentFactory(
              React, useState, useEffect, useMemo, useCallback,
              Button, ChevronLeft, ChevronRight, ArrowLeft, ArrowRight,
              CheckCircle, XCircle, TrendingUp, TrendingDown,
              typeof Recharts !== 'undefined' ? Recharts : {}
            );

            // Render the component
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(Component));

            // Send success message
            window.parent.postMessage({ type: 'RENDER_SUCCESS' }, '*');
          }
        } catch (error) {
          console.error('Render error:', error);

          // Display error in iframe
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(
            React.createElement('div', {
              style: {
                padding: '20px',
                background: '#fee',
                color: '#c00',
                borderRadius: '8px',
                margin: '20px',
                fontFamily: 'monospace',
                fontSize: '14px'
              }
            }, error.toString())
          );

          // Send error message to parent
          window.parent.postMessage({
            type: 'RENDER_ERROR',
            error: error.toString()
          }, '*');
        }
      }
    });

    // Notify parent that iframe is ready
    window.parent.postMessage({ type: 'IFRAME_READY' }, '*');
  </script>
</body>
</html>
